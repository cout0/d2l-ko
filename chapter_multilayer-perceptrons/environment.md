# 환경 및 유통 변화

이전 섹션에서는 다양한 데이터 세트에 모델을 피팅하는 기계 학습의 여러 실습 응용 프로그램을 진행했습니다.그러나 우리는 처음부터 데이터가 어디서 왔는지 또는 모델의 출력으로 궁극적으로 무엇을 할 계획인지 숙고하기 위해 멈추지 않았습니다.데이터를 보유한 머신 러닝 개발자는 이러한 근본적인 문제를 고려하기 위해 일시 중지하지 않고 모델을 개발하기 위해 서두르는 경우가 너무 많습니다. 

실패한 많은 머신 러닝 배포는 이 패턴으로 거슬러 올라갈 수 있습니다.때로는 모델이 테스트 세트 정확도로 측정했을 때 놀라운 성능을 발휘하지만 데이터 분포가 갑자기 바뀌면 배포 과정에서 치명적으로 실패하는 것처럼 보입니다.좀 더 교활하게도 때로는 모델을 배포하는 것이 데이터 분포를 교란시키는 촉매제가 될 수 있습니다.예를 들어, 대출에 대한 상환 대 채무 불이행을 예측하는 모델을 훈련하여 신청자의 신발 선택이 채무 불이행 위험과 관련이 있음을 발견했습니다 (Oxfords는 상환을 나타내고 운동화는 채무 불이행을 나타냄).그 후 옥스포드를 착용 한 모든 지원자에게 대출을 제공하고 운동화를 착용 한 모든 지원자를 거부 할 수 있습니다. 

이 경우 패턴 인식에서 의사 결정으로의 부당한 도약과 환경을 비판적으로 고려하지 않으면 재앙적인 결과를 초래할 수 있습니다.우선, 신발을 기반으로 결정을 내리기 시작하자마자 고객은 행동을 포착하고 변화시킬 것입니다.머지 않아 모든 지원자는 신용 가치가 동시에 개선되지 않고 옥스포드를 착용하게 될 것입니다.기계 학습의 많은 응용 분야에서 유사한 문제가 많기 때문에 잠시 시간을내어 이해하십시오. 모델 기반 의사 결정을 환경에 도입하면 모델이 깨질 수 있습니다. 

한 섹션에서 이러한 주제를 완벽하게 처리 할 수는 없지만 여기서는 몇 가지 일반적인 우려 사항을 폭로하고 이러한 상황을 조기에 감지하고 피해를 완화하며 책임감있게 기계 학습을 사용하는 데 필요한 비판적 사고를 자극하는 것을 목표로합니다.일부 솔루션은 간단하고 (“올바른”데이터 요청) 일부는 기술적으로 어렵고 (강화 학습 시스템 구현) 다른 솔루션은 통계적 예측 영역을 완전히 벗어나 윤리적 적용에 관한 어려운 철학적 질문과 씨름해야합니다.알고리즘. 

## 분포 이동의 유형

먼저 데이터 분포가 바뀔 수 있는 다양한 방식과 모델 성능을 개선하기 위해 수행할 수 있는 작업을 고려하여 수동 예측 설정을 고수합니다.한 가지 일반적인 설정에서는 훈련 데이터가 일부 분포 $p_S(\mathbf{x},y)$에서 샘플링되었지만 테스트 데이터는 일부 다른 분포 $p_T(\mathbf{x},y)$에서 가져온 레이블이 지정되지 않은 예제로 구성된다고 가정합니다.이미 우리는 냉정한 현실에 맞서야 합니다.$p_S$과 $p_T$가 서로 어떻게 관련되어 있는지에 대한 가정이 없으면 강력한 분류기를 배우는 것은 불가능합니다. 

개와 고양이를 구별하려는 이진 분류 문제를 생각해 보십시오.분포가 임의의 방식으로 이동할 수 있다면, 우리의 설정은 입력에 대한 분포가 일정하게 유지되는 병리학 적 사례 ($p_S(\mathbf{x}) = p_T(\mathbf{x})$) 를 허용하지만 레이블은 모두 뒤집힌 $p_S(y | \mathbf{x}) = 1 - p_T(y | \mathbf{x})$입니다.다시 말해, 만약 하나님께서 미래에 모든 “고양이”가 이제 개이고 우리가 이전에 “개”라고 불렀던 것이 이제 고양이라고 갑자기 결정할 수 있다면, 입력값 $p(\mathbf{x})$의 분포에 아무런 변화가 없다면, 우리는 이 설정을 분포가 전혀 변하지 않은 설정과 구별할 수 없을 것입니다. 

다행히도 향후 데이터가 변경 될 수있는 방식에 대한 몇 가지 제한된 가정 하에서 원칙적인 알고리즘은 변화를 감지하고 때로는 즉석에서 적응하여 원래 분류기의 정확성을 향상시킬 수 있습니다. 

### 공변량 이동

분포 이동 범주 중에서 공변량 이동이 가장 널리 연구될 수 있습니다.여기서는 입력값의 분포가 시간이 지남에 따라 변할 수 있지만 레이블 지정 함수, 즉 조건부 분포 $P(y \mid \mathbf{x})$는 변경되지 않는다고 가정합니다.통계학자들은 공변량 (특징) 분포의 이동으로 인해 문제가 발생하기 때문에 이를 *공변량 이동*이라고 합니다.때때로 인과 관계를 호출하지 않고 분포 이동에 대해 추론 할 수 있지만 공변량 이동은 $\mathbf{x}$가 $y$을 유발한다고 생각하는 설정에서 호출하는 자연스러운 가정이라는 점에 유의하십시오. 

고양이와 개를 구분하는 문제를 생각해 보십시오.우리의 훈련 데이터는 :numref:`fig_cat-dog-train`의 종류의 이미지로 구성될 수 있습니다. 

![Training data for distinguishing cats and dogs.](../img/cat-dog-train.svg)
:label:`fig_cat-dog-train`

테스트 시간에는 :numref:`fig_cat-dog-test`에서 이미지를 분류하라는 메시지가 표시됩니다. 

![Test data for distinguishing cats and dogs.](../img/cat-dog-test.svg)
:label:`fig_cat-dog-test`

훈련 세트는 사진으로 구성되며 테스트 세트에는 만화만 포함되어 있습니다.테스트 세트와 특성이 크게 다른 데이터 세트에 대한 교육은 새 도메인에 적응하는 방법에 대한 일관된 계획이 없으면 문제가 발생할 수 있습니다. 

### 라벨 이동

*레이블 shift*는 반대 문제를 설명합니다.
여기서는 레이블 한계 $P(y)$이 변경될 수 있지만 클래스 조건부 분포 $P(\mathbf{x} \mid y)$은 도메인 간에 고정되어 있다고 가정합니다.라벨 이동은 $y$가 $\mathbf{x}$를 유발한다고 생각할 때 합리적인 가정입니다.예를 들어, 진단의 상대적 유병률이 시간이 지남에 따라 변하더라도 증상 (또는 기타 증상) 이 주어지면 진단을 예측할 수 있습니다.질병이 증상을 유발하기 때문에 라벨 이동이 적절한 가정입니다.일부 퇴화된 경우에는 레이블 이동 및 공변량 이동 가정이 동시에 유지될 수 있습니다.예를 들어, 레이블이 결정론적인 경우 $y$가 $\mathbf{x}$를 유발하는 경우에도 공변량 이동 가정이 충족됩니다.흥미롭게도 이러한 경우 레이블 이동 가정으로부터 흐르는 방법으로 작업하는 것이 유리한 경우가 많습니다.이러한 방법은 딥러닝에서 고차원적인 경향이 있는 입력처럼 보이는 객체와 달리 레이블처럼 보이는 객체 (종종 저차원) 를 조작하는 경향이 있기 때문입니다. 

### 컨셉 시프트

레이블의 정의가 바뀔 때 발생하는*개념 이동*과 관련된 문제도 발생할 수 있습니다.이상하게 들리는데 —*고양이*는*고양이*입니다, 안돼?그러나 다른 범주는 시간이 지남에 따라 사용량이 변경될 수 있습니다.정신 질환에 대한 진단 기준, 유행에 대한 통과 및 직책은 모두 상당한 양의 개념 변화의 대상이됩니다.미국을 탐색하고 지역별로 데이터 소스를 이동하면 :numref:`fig_popvssoda`에 표시된대로*청량 음료*의 이름 분포와 관련하여 상당한 개념 변화를 발견하게 될 것입니다. 

![Concept shift on soft drink names in the United States.](../img/popvssoda.png)
:width:`400px`
:label:`fig_popvssoda`

기계 번역 시스템을 구축하려는 경우 배포 $P(y \mid \mathbf{x})$는 위치에 따라 다를 수 있습니다.이 문제는 발견하기가 까다로울 수 있습니다.우리는 변화가 시간적 또는 지리적 의미에서 점진적으로 일어난다는 지식을 활용하기를 희망할 수 있습니다. 

## 분포 이동의 예

형식주의와 알고리즘을 탐구하기 전에 공변량이나 개념 이동이 명확하지 않은 몇 가지 구체적인 상황에 대해 논의 할 수 있습니다. 

### 의료 진단

암을 탐지하는 알고리즘을 설계한다고 가정해 보겠습니다.건강하고 아픈 사람으로부터 데이터를 수집하고 알고리즘을 훈련시킵니다.잘 작동하여 높은 정확도를 제공하며 의료 진단 분야에서 성공적인 경력을 쌓을 준비가되었다고 결론을 내립니다.
*그렇게 빠르지 않아.*

훈련 데이터를 발생시킨 분포와 야생에서 접하게 될 분포는 상당히 다를 수 있습니다.이것은 우리 중 일부 (저자) 가 몇 년 전에 함께 일한 불행한 스타트 업에게 일어났습니다.그들은 주로 노인들에게 영향을 미치는 질병에 대한 혈액 검사를 개발하고 있었고 환자로부터 채취 한 혈액 샘플을 사용하여 연구하기를 희망했습니다.그러나 이미 시스템에 있는 아픈 환자보다 건강한 남성에게서 혈액 샘플을 얻는 것이 훨씬 더 어렵습니다.이를 보상하기 위해 스타트 업은 대학 캠퍼스의 학생들에게 검사를 개발할 때 건강한 통제 역할을하도록 헌혈을 요청했습니다.그런 다음 질병을 감지하기 위한 분류기를 만드는 데 도움을 줄 수 있는지 물었습니다. 

우리가 설명했듯이, 건강한 집단과 병든 집단을 거의 완벽한 정확도로 구별하는 것은 실제로 쉬울 것입니다.그러나 이는 피험자가 연령, 호르몬 수치, 신체 활동, 식이 요법, 알코올 섭취 및 질병과 관련이없는 더 많은 요인이 다르기 때문입니다.실제 환자에게는 그렇지 않을 것입니다.표본 추출 절차로 인해 극심한 공변량 이동이 발생할 것으로 예상 할 수 있습니다.더욱이, 이 사건은 기존 방법으로는 수정할 수 없을 것입니다.요컨대, 그들은 상당한 돈을 낭비했습니다. 

### 자율 주행 자동차

한 회사가 자율 주행 자동차 개발을 위해 머신 러닝을 활용하고 싶다고 가정해 보겠습니다.여기서 핵심 구성 요소 중 하나는 도로변 감지기입니다.주석이 달린 실제 데이터는 얻는 데 비용이 많이 들기 때문에 게임 렌더링 엔진의 합성 데이터를 추가 교육 데이터로 사용한다는 (현명하고 의심스러운) 아이디어가 있었습니다.렌더링 엔진에서 가져온 “테스트 데이터”에서 정말 잘 작동했습니다.아아, 진짜 차 안에서는 재앙이었습니다.결과적으로 길가는 매우 단순한 질감으로 렌더링되었습니다.더 중요한 것은*모두*길가*동일한* 텍스처로 렌더링되었으며 길가 감지기는이 “특징”에 대해 매우 빠르게 알게되었습니다. 

미군이 숲에서 탱크를 처음 탐지하려고 시도했을 때도 비슷한 일이 일어났습니다.그들은 탱크가없는 숲의 항공 사진을 찍은 다음 탱크를 숲으로 몰아 넣고 또 다른 사진을 찍었습니다.분류기는*완벽하게* 작동하는 것처럼 보였습니다.안타깝게도 그림자가 있는 나무와 그림자가 없는 나무를 구별하는 방법을 배웠습니다. 첫 번째 사진 세트는 이른 아침에 촬영되었고 두 번째 사진은 정오에 촬영되었습니다. 

### 비정규 분포

분포가 느리게 변하고 (*비정규 분포*라고도 함) 모형이 적절하게 업데이트되지 않으면 훨씬 더 미묘한 상황이 발생합니다.다음은 몇 가지 일반적인 사례입니다. 

* 전산 광고 모델을 훈련시킨 다음 자주 업데이트하지 못합니다 (예: iPad라는 모호한 새 장치가 방금 출시되었다는 사실을 통합하는 것을 잊었습니다).
* 스팸 필터를 구축합니다.지금까지 본 모든 스팸을 탐지하는 데 효과적입니다.그러나 스패머는 현명하고 이전에 본 것과는 다른 새로운 메시지를 만듭니다.
* 우리는 제품 추천 시스템을 구축합니다.겨울 내내 작동하지만 크리스마스 이후에도 산타 모자를 계속 추천합니다.

### 더 많은 일화

* 얼굴 감지기를 만듭니다.모든 벤치마크에서 잘 작동합니다.안타깝게도 테스트 데이터에서는 실패합니다. 문제가 되는 예는 얼굴이 전체 이미지를 채우는 클로즈업입니다 (훈련 세트에 해당 데이터가 없음).
* 우리는 미국 시장을위한 웹 검색 엔진을 구축하고 영국에 배포하려고합니다.
* 우리는 큰 클래스 집합 중 각각이 데이터 세트에 동일하게 표현되는 큰 데이터 세트 (예: 각각 1000 개의 이미지로 표시되는 1000 개의 범주) 를 컴파일하여 이미지 분류기를 훈련시킵니다.그런 다음 사진의 실제 라벨 분포가 확실히 균일하지 않은 현실 세계에 시스템을 배포합니다.

## 분포 이동의 수정

앞서 논의했듯이 훈련 및 테스트 분포 $P(\mathbf{x}, y)$가 다른 경우가 많습니다.공변량, 레이블 또는 개념 이동에도 불구하고 운이 좋고 모델이 작동하는 경우도 있습니다.다른 경우에는 변화에 대처하기 위해 원칙적인 전략을 채택함으로써 더 잘할 수 있습니다.이 섹션의 나머지 부분은 훨씬 더 기술적으로 발전합니다.이 자료는 후속 개념의 전제 조건이 아니기 때문에 참을성이없는 독자는 다음 섹션으로 계속 진행할 수 있습니다. 

### 경험적 위험 및 위험
:label:`subsec_empirical-risk-and-risk`

먼저 모델 학습 중에 정확히 어떤 일이 일어나고 있는지 생각해 보겠습니다. 학습 데이터 $\{(\mathbf{x}_1, y_1), \ldots, (\mathbf{x}_n, y_n)\}$의 기능 및 관련 레이블을 반복하고 모든 미니 배치 후에 모델 $f$의 매개 변수를 업데이트합니다.단순화를 위해 정규화를 고려하지 않으므로 교육 손실을 크게 최소화합니다. 

$$\mathop{\mathrm{minimize}}_f \frac{1}{n} \sum_{i=1}^n l(f(\mathbf{x}_i), y_i),$$
:eqlabel:`eq_empirical-risk-min`

여기서 $l$은 “얼마나 나쁜지”를 측정하는 손실 함수입니다. 예측 $f(\mathbf{x}_i)$에는 관련 레이블 $y_i$이 지정됩니다.통계학자들은 :eqref:`eq_empirical-risk-min`*경험적 위험*에서 용어를 부릅니다.*경험적 위험*은 실제 분포 $p(\mathbf{x},y)$에서 도출된 전체 데이터 모집단에 대한 손실 예상치인*위험*에 근접한 훈련 데이터에 대한 평균 손실입니다. 

$$E_{p(\mathbf{x}, y)} [l(f(\mathbf{x}), y)] = \int\int l(f(\mathbf{x}), y) p(\mathbf{x}, y) \;d\mathbf{x}dy.$$
:eqlabel:`eq_true-risk`

그러나 실제로는 일반적으로 전체 데이터 모집단을 얻을 수 없습니다.따라서 :eqref:`eq_empirical-risk-min`의 경험적 위험을 최소화하는 *경험적 위험 최소화*는 위험을 최소화하기 위해 기계 학습을 위한 실용적인 전략입니다. 

### 공변량 이동 수정
:label:`subsec_covariate-shift-correction`

데이터 $(\mathbf{x}_i, y_i)$에 레이블을 지정한 일부 종속성 $P(y \mid \mathbf{x})$를 추정한다고 가정합니다.안타깝게도 관측치 $\mathbf{x}_i$은*목표 분포* $p(\mathbf{x})$이 아닌 일부*출처 분포* $q(\mathbf{x})$에서 추출됩니다.다행히 종속성 가정은 조건부 분포가 변경되지 않는다는 것을 의미합니다. $p(y \mid \mathbf{x}) = q(y \mid \mathbf{x})$.소스 배포 $q(\mathbf{x})$이 “잘못된” 경우 위험에 다음과 같은 간단한 ID를 사용하여 수정할 수 있습니다. 

$$
\begin{aligned}
\int\int l(f(\mathbf{x}), y) p(y \mid \mathbf{x})p(\mathbf{x}) \;d\mathbf{x}dy =
\int\int l(f(\mathbf{x}), y) q(y \mid \mathbf{x})q(\mathbf{x})\frac{p(\mathbf{x})}{q(\mathbf{x})} \;d\mathbf{x}dy.
\end{aligned}
$$

즉, 올바른 분포에서 추출되었을 확률과 잘못된 분포에서 도출되었을 확률의 비율로 각 데이터 예제를 재평가해야 합니다. 

$$\beta_i \stackrel{\mathrm{def}}{=} \frac{p(\mathbf{x}_i)}{q(\mathbf{x}_i)}.$$

각 데이터 (예: $(\mathbf{x}_i, y_i)$) 에 대해 가중치 $\beta_i$를 연결하면 다음을 사용하여 모델을 학습할 수 있습니다.
*가중 경험적 위험 최소화*:

$$\mathop{\mathrm{minimize}}_f \frac{1}{n} \sum_{i=1}^n \beta_i l(f(\mathbf{x}_i), y_i).$$
:eqlabel:`eq_weighted-empirical-risk-min`

아아, 우리는 그 비율을 모르기 때문에 유용한 일을하기 전에 추정해야합니다.최소 노름 또는 최대 엔트로피 원리를 사용하여 기대 연산자를 직접 재보정하려는 몇 가지 멋진 연산자 이론적 접근법을 포함하여 많은 방법을 사용할 수 있습니다.이러한 접근 방식에는 테스트 데이터에 액세스하여 “true” $p$과 훈련 세트 $q$ (후자는 사소한 사용 가능) 을 생성하는 데 사용되는 두 분포에서 추출한 샘플이 필요합니다.그러나 기능 $\mathbf{x} \sim p(\mathbf{x})$만 필요하며 레이블 $y \sim p(y)$에 액세스할 필요는 없습니다. 

이 경우 이진 분류에 대한 소프트맥스 회귀 (:numref:`sec_softmax` 참조) 의 특수한 경우인 로지스틱 회귀 분석과 거의 동일한 결과를 제공하는 매우 효과적인 접근 방식이 있습니다.추정 확률 비율을 계산하는 데 필요한 전부입니다.$p(\mathbf{x})$에서 가져온 데이터와 $q(\mathbf{x})$에서 가져온 데이터를 구별하는 분류기를 배웁니다.두 분포를 구분할 수 없는 경우 연관된 인스턴스가 두 분포 중 하나에서 나올 가능성이 동일하다는 의미입니다.반면에 잘 차별될 수 있는 모든 사례는 그에 따라 상당히 과가중되거나 저가중되어야 합니다. 

단순화를 위해 두 배포판 $p(\mathbf{x})$와 $q(\mathbf{x})$에서 각각 동일한 수의 인스턴스가 있다고 가정합니다.이제 $p$에서 가져온 데이터의 경우 $1$인 $z$ 레이블로, $q$에서 가져온 데이터의 경우 $-1$으로 나타냅니다.그런 다음 혼합 데이터셋의 확률은 다음과 같습니다. 

$$P(z=1 \mid \mathbf{x}) = \frac{p(\mathbf{x})}{p(\mathbf{x})+q(\mathbf{x})} \text{ and hence } \frac{P(z=1 \mid \mathbf{x})}{P(z=-1 \mid \mathbf{x})} = \frac{p(\mathbf{x})}{q(\mathbf{x})}.$$

따라서 $P(z=1 \mid \mathbf{x})=\frac{1}{1+\exp(-h(\mathbf{x}))}$ ($h$가 매개 변수화 된 함수) 인 로지스틱 회귀 접근법을 사용하면 다음과 같습니다. 

$$
\beta_i = \frac{1/(1 + \exp(-h(\mathbf{x}_i)))}{\exp(-h(\mathbf{x}_i))/(1 + \exp(-h(\mathbf{x}_i)))} = \exp(h(\mathbf{x}_i)).
$$

결과적으로 두 분포에서 가져온 데이터를 구별하는 첫 번째 문제와 :eqref:`eq_weighted-empirical-risk-min`의 가중 경험적 위험 최소화 문제라는 두 가지 문제를 해결해야 합니다. 

이제 수정 알고리즘을 설명할 준비가 되었습니다.훈련 세트 $\{(\mathbf{x}_1, y_1), \ldots, (\mathbf{x}_n, y_n)\}$와 레이블이 지정되지 않은 테스트 세트 $\{\mathbf{u}_1, \ldots, \mathbf{u}_m\}$가 있다고 가정합니다.공변량 이동의 경우 모든 $1 \leq i \leq n$에 대한 $\mathbf{x}_i$이 일부 출처 분포에서 추출되고 모든 $1 \leq i \leq m$에 대한 $\mathbf{u}_i$가 목표 분포에서 추출된다고 가정합니다.다음은 공변량 이동을 수정하기 위한 원형 알고리즘입니다. 

1. 이진 분류 훈련 세트 $\{(\mathbf{x}_1, -1), \ldots, (\mathbf{x}_n, -1), (\mathbf{u}_1, 1), \ldots, (\mathbf{u}_m, 1)\}$를 생성합니다.
1. 로지스틱 회귀를 사용하여 이진 분류기를 훈련시켜 함수 $h$를 얻습니다.
1. 일부 상수 $c$에 대해 $\beta_i = \exp(h(\mathbf{x}_i))$ 또는 그 이상의 $\beta_i = \min(\exp(h(\mathbf{x}_i)), c)$를 사용하여 훈련 데이터의 무게를 측정합니다.
1. :eqref:`eq_weighted-empirical-risk-min`에서 $\{(\mathbf{x}_1, y_1), \ldots, (\mathbf{x}_n, y_n)\}$에 대한 교육을 위해 가중치 $\beta_i$을 사용하십시오.

위의 알고리즘은 중요한 가정에 의존합니다.이 체계가 작동하려면 목표 (예: 테스트 시간) 분포의 각 데이터 예제가 훈련 시간에 발생할 확률이 0이 아니어야 합니다.$p(\mathbf{x}) > 0$가 아니라 $q(\mathbf{x}) = 0$인 점을 찾으면 해당 중요도 가중치는 무한대여야 합니다. 

### 라벨 시프트 수정

$k$ 범주의 분류 작업을 처리한다고 가정합니다.:numref:`subsec_covariate-shift-correction`에서 동일한 표기법을 사용하는 $q$ 및 $p$은 각각 소스 분포 (예: 훈련 시간) 와 목표 분포 (예: 테스트 시간) 입니다.레이블 분포가 시간이 지남에 따라 이동한다고 가정합니다 ($q(y) \neq p(y)$). 그러나 클래스 조건부 분포는 $q(\mathbf{x} \mid y)=p(\mathbf{x} \mid y)$로 유지됩니다.소스 배포 $q(y)$이 “잘못된” 경우 :eqref:`eq_true-risk`에 정의된 위험의 다음 ID에 따라 수정할 수 있습니다. 

$$
\begin{aligned}
\int\int l(f(\mathbf{x}), y) p(\mathbf{x} \mid y)p(y) \;d\mathbf{x}dy =
\int\int l(f(\mathbf{x}), y) q(\mathbf{x} \mid y)q(y)\frac{p(y)}{q(y)} \;d\mathbf{x}dy.
\end{aligned}
$$

여기서 중요도 가중치는 레이블 우도 비율에 해당합니다. 

$$\beta_i \stackrel{\mathrm{def}}{=} \frac{p(y_i)}{q(y_i)}.$$

레이블 이동에 대한 한 가지 좋은 점은 소스 분포에 대해 합리적으로 좋은 모델이 있으면 주변 차원을 다루지 않고도 이러한 가중치에 대한 일관된 추정치를 얻을 수 있다는 것입니다.딥러닝에서 입력값은 이미지와 같은 고차원 객체인 경향이 있지만 레이블은 범주와 같이 단순한 객체인 경우가 많습니다. 

목표 레이블 분포를 추정하기 위해 먼저 합리적으로 우수한 상용 분류기 (일반적으로 훈련 데이터에 대해 훈련됨) 를 사용하고 검증 세트 (훈련 분포에서도) 를 사용하여 정오분류표를 계산합니다.*정오분류표*, $\mathbf{C}$는 단순히 $k \times k$ 행렬입니다. 여기서 각 열은 레이블 범주 (실측) 에 해당하고 각 행은 모델의 예측 범주에 해당합니다.각 셀의 값 $c_{ij}$는 실제 레이블이 $j$이고 모델이 $i$을 예측한 검증 집합에 대한 총 예측의 비율입니다. 

이제는 복잡한 실시간 주석 파이프라인에 투자하지 않는 한 야생에서 볼 수 있는 예제의 레이블을 볼 수 없기 때문에 대상 데이터에 대한 혼동 행렬을 직접 계산할 수 없습니다.그러나 우리가 할 수 있는 것은 테스트 시간에 모든 모델 예측의 평균을 함께 계산하여 평균 모델 출력값 $\mu(\hat{\mathbf{y}}) \in \mathbb{R}^k$를 산출하는 것입니다. $i^\mathrm{th}$ 요소 $\mu(\hat{y}_i)$는 모델이 $i$을 예측한 테스트 세트에 대한 총 예측의 비율입니다. 

분류기가 처음에 합리적으로 정확하고 대상 데이터에 이전에 본 범주만 포함되어 있고 레이블 이동 가정이 처음부터 유지되는 경우 (여기서 가장 강력한 가정) 일부 온화한 조건에서 테스트 세트 레이블을 추정 할 수 있습니다.간단한 선형 시스템을 풀어서 분포 

$$\mathbf{C} p(\mathbf{y}) = \mu(\hat{\mathbf{y}}),$$

추정치로 $\sum_{j=1}^k c_{ij} p(y_j) = \mu(\hat{y}_i)$는 모든 $1 \leq i \leq k$에 대해 유지되기 때문입니다. 여기서 $p(y_j)$는 $k$차원 레이블 분포 벡터 $p(\mathbf{y})$의 $j^\mathrm{th}$ 요소입니다.분류기가 시작하기에 충분히 정확하다면 혼동 행렬 $\mathbf{C}$은 반전될 수 있으며 해법 $p(\mathbf{y}) = \mathbf{C}^{-1} \mu(\hat{\mathbf{y}})$를 얻습니다. 

원본 데이터에서 레이블을 관찰하기 때문에 분포 $q(y)$을 쉽게 추정할 수 있습니다.그런 다음 레이블이 $y_i$인 모든 교육 예제 $i$의 경우 추정된 $p(y_i)/q(y_i)$의 비율을 취하여 가중치 $\beta_i$를 계산하고 이를 :eqref:`eq_weighted-empirical-risk-min`의 가중 경험적 위험 최소화에 연결할 수 있습니다. 

### 컨셉 시프트 수정

개념 전환은 원칙적인 방식으로 수정하기가 훨씬 어렵습니다.예를 들어, 갑자기 문제가 고양이와 개를 구별하는 것에서 흰색과 검은 동물을 구별하는 것으로 바뀌는 상황에서 새로운 라벨을 수집하고 처음부터 훈련하는 것보다 훨씬 더 잘할 수 있다고 가정하는 것은 무리가 될 것입니다.다행히도 실제로 이러한 극단적 인 변화는 드뭅니다.대신 일반적으로 발생하는 작업은 작업이 계속 느리게 변경되는 것입니다.좀 더 구체적으로 설명하기 위해 다음과 같은 몇 가지 예가 있습니다. 

* 전산 광고에서는 신제품이 출시되고
오래된 제품은 덜 인기가 있습니다.즉, 광고에 대한 분포와 인기도는 점차 변하고 클릭률 예측자는 그에 따라 점진적으로 변경되어야 합니다.
* 교통 카메라 렌즈는 환경 마모로 인해 점차 저하되어 이미지 품질에 점진적으로 영향을 미칩니다.
* 뉴스 콘텐츠는 점진적으로 변경됩니다 (즉, 대부분의 뉴스는 변경되지 않지만 새로운 스토리가 표시됨).

이러한 경우 네트워크를 훈련시키는 데 사용한 것과 동일한 접근 방식을 사용하여 데이터 변화에 적응하도록 할 수 있습니다.즉, 기존 네트워크 가중치를 사용하고 처음부터 훈련하는 대신 새 데이터로 몇 가지 업데이트 단계를 수행합니다. 

## 학습 문제의 분류법

분포의 변화를 처리하는 방법에 대한 지식으로 무장하여 이제 기계 학습 문제 공식화의 몇 가지 다른 측면을 고려할 수 있습니다. 

### 배치 학습

*배치 학습*에서는 모델 $f(\mathbf{x})$를 학습하는 데 사용하는 학습 기능 및 레이블 $\{(\mathbf{x}_1, y_1), \ldots, (\mathbf{x}_n, y_n)\}$에 액세스할 수 있습니다.나중에 이 모델을 배포하여 동일한 분포에서 가져온 새 데이터 $(\mathbf{x}, y)$의 점수를 매깁니다.이것이 여기서 논의하는 모든 문제에 대한 기본 가정입니다.예를 들어, 많은 고양이와 개 사진을 기반으로 고양이 탐지기를 훈련시킬 수 있습니다.교육을 마친 후에는 고양이만 들어갈 수 있는 스마트 캣도어 컴퓨터 비전 시스템의 일부로 배송합니다.그런 다음 고객의 집에 설치되며 다시는 업데이트되지 않습니다 (극한 상황 제외). 

### 온라인 학습

이제 데이터 $(\mathbf{x}_i, y_i)$이 한 번에 하나의 샘플에 도착한다고 가정해 보겠습니다.좀 더 구체적으로, 우리가 먼저 $\mathbf{x}_i$를 관찰했다고 가정하고, 추정 $f(\mathbf{x}_i)$를 생각해 내야하며, 이 작업을 수행 한 후에야 $y_i$을 관찰하고 결정을 내릴 때 보상을 받거나 손실을 입습니다.많은 실제 문제가이 범주에 속합니다.예를 들어, 내일의 주가를 예측해야합니다. 이를 통해 해당 추정치를 기반으로 거래 할 수 있으며 하루가 끝날 때 추정치가 수익을 낼 수 있는지 여부를 알 수 있습니다.즉, *온라인 학습*에는 새로운 관찰이 주어지면 모델을 지속적으로 개선하는 다음 주기가 있습니다. 

$$
\mathrm{model} ~ f_t \longrightarrow
\mathrm{data} ~ \mathbf{x}_t \longrightarrow
\mathrm{estimate} ~ f_t(\mathbf{x}_t) \longrightarrow
\mathrm{observation} ~ y_t \longrightarrow
\mathrm{loss} ~ l(y_t, f_t(\mathbf{x}_t)) \longrightarrow
\mathrm{model} ~ f_{t+1}
$$

### 산적

*밴딧*은 위 문제의 특별한 경우입니다.대부분의 학습 문제에는 매개 변수 (예: 심층 네트워크) 를 배우고 자하는 지속적으로 매개 변수화 된 함수 $f$가 있지만, *산적* 문제에서는 당길 수있는 유한 수의 팔, 즉 취할 수있는 유한 수의 행동 만 있습니다.이 단순한 문제에 대해 최적성 측면에서 더 강력한 이론적 보장을 얻을 수 있다는 것은 그리 놀라운 일이 아닙니다.이 문제는 종종 뚜렷한 학습 환경인 것처럼 (혼란스럽게) 취급되기 때문에 주로 나열합니다.

### 컨트롤

대부분의 경우 환경은 우리가 한 일을 기억합니다.반드시 적대적인 방식은 아니지만 기억할 뿐이며 응답은 이전에 일어난 일에 따라 달라집니다.예를 들어 커피 보일러 컨트롤러는 이전에 보일러를 가열했는지 여부에 따라 다른 온도를 관찰합니다.PID (비례-적분-미분) 제어기 알고리즘은 여기서 널리 사용되는 선택입니다.마찬가지로 뉴스 사이트에서 사용자의 행동은 이전에 보여준 내용에 따라 달라집니다 (예: 대부분의 뉴스를 한 번만 읽음).이러한 많은 알고리즘은 의사 결정을 덜 무작위로 보이게하는 것과 같이 행동하는 환경 모델을 형성합니다.최근에는 제어 이론 (예: PID 변형) 을 사용하여 하이퍼 파라미터를 자동으로 조정하여 더 나은 분리 및 재구성 품질을 달성하고 생성 된 텍스트의 다양성과 생성 된 이미지의 재구성 품질을 향상시킵니다. :cite:`Shao.Yao.Sun.ea.2020`. 

### 강화 학습

기억이 있는 환경의 보다 일반적인 경우 환경이 우리와 협력하려는 상황 (특히 제로섬이 아닌 게임의 경우 협동 게임) 이나 환경이 승리하려는 상황이 발생할 수 있습니다.체스, 바둑, 주사위 놀이 또는 스타크래프트는 강화 학습*의 일부 사례입니다.마찬가지로 자율 주행 자동차에 적합한 컨트롤러를 만들고 싶을 수도 있습니다.다른 차량은 자율 주행 자동차의 운전 스타일에 사소한 방식으로 반응 할 가능성이 높습니다. 예를 들어, 이를 피하려고 시도하고, 사고를 일으키거나, 협조하려고 시도합니다. 

### 환경에 대한 고려

위의 여러 상황 간의 주요 차이점 중 하나는 고정 환경의 경우 전체적으로 작동했을 수있는 동일한 전략이 환경이 적응할 수있을 때 전체적으로 작동하지 않을 수 있다는 것입니다.예를 들어, 트레이더가 발견한 차익거래 기회는 악용을 시작하면 사라질 가능성이 높습니다.환경이 변하는 속도와 방식은 우리가 감당할 수 있는 알고리즘의 유형을 크게 결정합니다.예를 들어 상황이 느리게 변할 수 있다는 것을 알고 있다면 추정치도 느리게만 변경하도록 강요 할 수 있습니다.환경이 순간적으로 변할 수 있지만 아주 드물게 변할 수 있다는 것을 알면 그에 대한 여유를 줄 수 있습니다.이러한 유형의 지식은 야심 찬 데이터 과학자가 개념 전환, 즉 해결하려는 문제가 시간이 지남에 따라 변할 때 처리하는 데 중요합니다. 

## 기계 학습의 공정성, 책임성 및 투명성

마지막으로, 기계 학습 시스템을 배포할 때는 단순히 예측 모델을 최적화하는 것이 아니라 일반적으로 의사 결정을 (부분적으로 또는 완전히) 자동화하는 데 사용되는 도구를 제공한다는 점을 기억해야 합니다.이러한 기술 시스템은 결과 결정에 따라 개인의 삶에 영향을 줄 수 있습니다.예측 고려에서 의사 결정으로의 도약은 새로운 기술적 질문뿐만 아니라 신중하게 고려해야 할 수많은 윤리적 질문을 제기합니다.의료 진단 시스템을 배포하는 경우 어떤 인구에 효과가 있고 그렇지 않을 수 있는지 알아야합니다.하위 인구의 복지에 대한 예측 가능한 위험을 간과하면 열등한 치료를 시행하게 될 수 있습니다.또한 의사 결정 시스템을 고려한 후에는 한 걸음 물러서서 기술을 평가하는 방법을 재고해야 합니다.이러한 범위 변경의 다른 결과 중에서도*정확성*이 올바른 척도가 아니라는 것을 알게 될 것입니다.예를 들어, 예측을 행동으로 변환할 때 다양한 방식으로 오류의 잠재적 비용 민감도를 고려하는 경우가 많습니다.이미지를 잘못 분류하는 한 가지 방법이 인종적 손재주로 인식 될 수 있고 다른 범주로의 오분류는 무해하다면 의사 결정 프로토콜을 설계 할 때 사회적 가치를 고려하여 그에 따라 임계 값을 조정할 수 있습니다.또한 예측 시스템이 피드백 루프로 이어질 수 있는 방법에 대해서도 주의를 기울이고 싶습니다.예를 들어, 범죄 예측이 높은 지역에 순찰 요원을 할당하는 예측 치안 시스템을 고려해 보십시오.걱정스러운 패턴이 어떻게 나타날 수 있는지 쉽게 알 수 있습니다. 

 1. 범죄가 많은 이웃은 더 많은 순찰을받습니다.
 1. 결과적으로 이러한 지역에서 더 많은 범죄가 발견되어 향후 반복에 사용할 수있는 교육 데이터가 입력됩니다.
 1. 이 모델은 더 긍정적 인 측면에 노출되어 이러한 지역에서 더 많은 범죄를 예측합니다.
 1. 다음 반복에서 업데이트된 모델은 동일한 지역을 훨씬 더 많이 타겟팅하여 더 많은 범죄가 발견되었습니다.

모델의 예측이 학습 데이터와 결합되는 다양한 메커니즘이 모델링 프로세스에서 설명되지 않는 경우가 많습니다.이로 인해 연구자들이*폭주 피드백 루프*라고 부르는 것으로 이어질 수 있습니다.또한 처음부터 올바른 문제를 해결하고 있는지 주의를 기울이고 싶습니다.예측 알고리즘은 이제 정보 보급을 중재하는 데 큰 역할을 합니다.개인이 만나는 뉴스는*좋아요*한 Facebook 페이지 집합에 따라 결정되어야 합니까?이는 기계 학습 경력에서 접할 수 있는 많은 시급한 윤리적 딜레마 중 일부에 불과합니다. 

## 요약

* 대부분의 경우 훈련 세트와 테스트 세트는 동일한 분포에서 제공되지 않습니다.이를 분포 이동이라고 합니다.
* 위험은 실제 분포에서 가져온 전체 데이터 모집단에 대한 손실을 예상하는 것입니다.그러나 이 전체 모집단은 일반적으로 사용할 수 없습니다.경험적 위험은 위험을 근사화하기 위해 훈련 데이터에 대한 평균 손실입니다.실제로 경험적 위험 최소화를 수행합니다.
* 해당 가정 하에서 검사 시간에 공변량과 레이블 이동을 탐지하고 수정할 수 있습니다.이러한 편향을 설명하지 못하면 테스트 시점에 문제가 될 수 있습니다.
* 경우에 따라 환경이 자동화된 작업을 기억하고 놀라운 방식으로 대응할 수 있습니다.모델을 구축하고 라이브 시스템을 계속 모니터링 할 때 이러한 가능성을 고려해야합니다. 모델과 환경이 예상치 못한 방식으로 얽힐 가능성에 개방되어 있습니다.

## 연습문제

1. 검색 엔진의 동작을 변경하면 어떻게 될까요?사용자는 무엇을 할 수 있을까요?광고주는 어떻습니까?
1. 공변량 이동 검출기를 구현합니다.힌트: 분류기를 만듭니다.
1. 공변량 이동 교정기를 구현합니다.
1. 분포 이동 외에도 경험적 위험이 위험을 근사화하는 방식에 영향을 미칠 수 있는 다른 요인은 무엇일까요?

[Discussions](https://discuss.d2l.ai/t/105)
